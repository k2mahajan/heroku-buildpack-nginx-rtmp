#!/usr/bin/env bash

# make sure we have a place for logs
mkdir -p logs/nginx
touch logs/nginx/access.log logs/nginx/error.log

echo 'buildpack=nginx at=logs-initialized'

# Redirect NGINX logs to stdout.
tail -qF -n 0 logs/nginx/*.log &

# Start NGINX
# We expect nginx to run in foreground.
echo 'buildpack=nginx at=nginx-start'
echo Port ${PORT}
sed -i 's/PORT/'${PORT}'/g' config/nginx.conf
cat config/nginx.conf| grep listen
bin/nginx -p . -c config/nginx.conf &
sleep 20
echo "buildpack=nginx at=nginx-started"

exit 0
